#!/bin/bash
set -e

BIN_DIR="/usr/local/bin"
APP_NAME="BBs Video CMS.app"
APP_RES="/Applications/${APP_NAME}/Contents/Resources"

FFMPEG_CANDIDATE="$(/usr/bin/find "$APP_RES/bin/ffmpeg-static" -type f -perm +111 -maxdepth 2 2>/dev/null | head -n 1)"
FFPROBE_CANDIDATE="$(/usr/bin/find "$APP_RES/bin/ffprobe-static" -type f -perm +111 -maxdepth 3 2>/dev/null | head -n 1)"

if ! command -v ffmpeg >/dev/null 2>&1 && [ -n "$FFMPEG_CANDIDATE" ]; then
  /bin/cp "$FFMPEG_CANDIDATE" "$BIN_DIR/ffmpeg" || true
  /bin/chmod +x "$BIN_DIR/ffmpeg" || true
fi

if ! command -v ffprobe >/dev/null 2>&1 && [ -n "$FFPROBE_CANDIDATE" ]; then
  /bin/cp "$FFPROBE_CANDIDATE" "$BIN_DIR/ffprobe" || true
  /bin/chmod +x "$BIN_DIR/ffprobe" || true
fi

exit 0
